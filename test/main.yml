---
- name: Bring up docker containers
  hosts: localhost
  gather_facts: false
  vars:
    inventory:
      - name: ansible_deps_host_1
        image: "{{container}}"
  roles:
    - { role: provision_docker, provision_docker_company: 'ansible', provision_docker_inventory: "{{ inventory }}" }

- name: Run ansible_deps Tests
  hosts: docker_containers
  vars:
    git_dir: "/tmp/ansible"
  tasks:
    - name: install jekyll
      include_role:
        name: "../../ansible_role-application-jekyll"

    - name: create test blog
      include_role:
        name: "../../ansible_role-application-jekyll"
        tasks_from: create_blog
      vars:
        jekyll_blog_name: ansible-test-blog
        jekyll_blog_base_dir: /tmp
      environment:
        PATH: "{{ ruby_install_path }}/gems/{{ ruby_version }}/bin:\
               {{ ruby_install_path }}/gems/{{ ruby_version }}@global/bin:\
               {{ ruby_install_path }}/rubies/{{ ruby_version }}/bin:\
               {{ ruby_install_path }}/bin:\
               {{ lookup('env', 'PATH') }}"
        GEM_PATH: "{{ ruby_install_path }}/gems/{{ ruby_version }}:\
                   {{ ruby_install_path }}/gems/{{ ruby_version }}@global"
